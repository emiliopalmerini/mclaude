// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.960
package dashboard

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"claude-watcher/internal/shared/templates"
	"fmt"
	"path/filepath"
)

func Dashboard(data DashboardData) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<h1>Dashboard</h1><div class=\"stats-grid\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Total Sessions", fmt.Sprintf("%d", data.Metrics.TotalSessions), "sessions").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Total Cost", fmt.Sprintf("$%.2f", toFloat(data.Metrics.TotalCostUsd)), "cost").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Total Tool Calls", fmt.Sprintf("%v", data.Metrics.TotalToolCalls), "tokens").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Avg Duration", fmt.Sprintf("%.0f min", toFloat(data.Metrics.AvgDurationSeconds)/60), "sessions").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "</div><section><h2>Quick Insights</h2><div class=\"stats-grid\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Cache Hit Rate", fmt.Sprintf("%.1f%%", data.CacheHitRate), "tokens").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Top Tool", data.TopTool, "sessions").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Top Project", shortPath(data.TopProject.Directory), "sessions").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Prompts/Session", fmt.Sprintf("%.1f", toFloat(data.EfficiencyMetrics.AvgPromptsPerSession)), "cost").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "</div></section><section><h2>Today</h2><div class=\"stats-grid\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Sessions", fmt.Sprintf("%d", data.Today.SessionsToday), "sessions").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Cost", fmt.Sprintf("$%.2f", toFloat(data.Today.CostToday)), "cost").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, "</div></section><section><h2>This Week</h2><div class=\"stats-grid\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Sessions", fmt.Sprintf("%d", data.Week.SessionsWeek), "sessions").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templates.StatsCard("Cost", fmt.Sprintf("$%.2f", toFloat(data.Week.CostWeek)), "cost").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 5, "</div></section><section id=\"charts-section\"><h2>Historical Trends</h2><div class=\"time-range\"><button class=\"time-range__btn time-range__btn--active\" data-range=\"7d\">7D</button> <button class=\"time-range__btn\" data-range=\"30d\">30D</button> <button class=\"time-range__btn\" data-range=\"90d\">90D</button></div><div class=\"charts-grid\"><div class=\"chart-card chart-card--full\"><div class=\"chart-card__title\">Sessions & Cost Over Time</div><div class=\"chart-card__container chart-card__container--full\"><canvas id=\"timeSeriesChart\"></canvas></div></div><div class=\"chart-card\"><div class=\"chart-card__title\">Cost by Model</div><div class=\"chart-card__container\"><canvas id=\"modelChart\"></canvas></div></div><div class=\"chart-card\"><div class=\"chart-card__title\">Activity by Hour of Day</div><div class=\"chart-card__container\"><canvas id=\"hourChart\"></canvas></div></div><div class=\"chart-card chart-card--full\"><div class=\"chart-card__title\">Token Usage Over Time</div><div class=\"chart-card__container chart-card__container--full\"><canvas id=\"tokenChart\"></canvas></div></div></div></section>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = chartsScript().Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = templates.Layout("Dashboard").Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

func chartsScript() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var3 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var3 == nil {
			templ_7745c5c3_Var3 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 6, "<script>\n\t\t(function() {\n\t\t\tconst charts = {};\n\t\t\tconst cache = {};\n\t\t\tconst ranges = ['7d', '30d', '90d'];\n\t\t\tlet currentRange = '7d';\n\n\t\t\tconst colors = {\n\t\t\t\tprimary: '#22c55e',\n\t\t\t\tsecondary: '#3b82f6',\n\t\t\t\tinput: '#3b82f6',\n\t\t\t\toutput: '#22c55e',\n\t\t\t\tthinking: '#f59e0b',\n\t\t\t\tgrid: '#1a1a1a',\n\t\t\t\ttext: '#666666'\n\t\t\t};\n\n\t\t\tconst baseOptions = {\n\t\t\t\tresponsive: true,\n\t\t\t\tmaintainAspectRatio: false,\n\t\t\t\tanimation: false,\n\t\t\t\tplugins: { legend: { labels: { color: colors.text } } },\n\t\t\t\tscales: {\n\t\t\t\t\tx: { grid: { color: colors.grid }, ticks: { color: colors.text } },\n\t\t\t\t\ty: { grid: { color: colors.grid }, ticks: { color: colors.text } }\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfunction formatLabel(period) {\n\t\t\t\tif (!period) return '';\n\t\t\t\tif (period.includes('T')) {\n\t\t\t\t\treturn new Date(period).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n\t\t\t\t}\n\t\t\t\treturn new Date(period).toLocaleDateString([], { month: 'short', day: 'numeric' });\n\t\t\t}\n\n\t\t\tfunction formatModel(m) {\n\t\t\t\tif (!m) return 'Unknown';\n\t\t\t\treturn m.replace('claude-', '').replace(/-\\d+$/, '');\n\t\t\t}\n\n\t\t\tfunction createChart(id, config) {\n\t\t\t\tconst el = document.getElementById(id);\n\t\t\t\tif (!el) return;\n\t\t\t\tif (charts[id]) charts[id].destroy();\n\t\t\t\tcharts[id] = new Chart(el, config);\n\t\t\t}\n\n\t\t\tfunction renderCharts(data) {\n\t\t\t\tif (!data) return;\n\n\t\t\t\tconst ts = data.timeSeries || [];\n\t\t\t\tcreateChart('timeSeriesChart', {\n\t\t\t\t\ttype: 'line',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tlabels: ts.map(d => formatLabel(d.period)),\n\t\t\t\t\t\tdatasets: [\n\t\t\t\t\t\t\t{ label: 'Sessions', data: ts.map(d => d.sessions), borderColor: colors.primary, backgroundColor: colors.primary + '15', fill: true, tension: 0.3, yAxisID: 'y' },\n\t\t\t\t\t\t\t{ label: 'Cost ($)', data: ts.map(d => d.cost), borderColor: colors.secondary, backgroundColor: 'transparent', tension: 0.3, yAxisID: 'y1' }\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\toptions: { ...baseOptions, scales: { x: baseOptions.scales.x, y: { ...baseOptions.scales.y, position: 'left', beginAtZero: true }, y1: { ...baseOptions.scales.y, position: 'right', beginAtZero: true, grid: { drawOnChartArea: false } } } }\n\t\t\t\t});\n\n\t\t\t\tconst models = data.models || [];\n\t\t\t\tif (models.length > 0) {\n\t\t\t\t\tcreateChart('modelChart', {\n\t\t\t\t\t\ttype: 'doughnut',\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tlabels: models.map(d => formatModel(d.model)),\n\t\t\t\t\t\t\tdatasets: [{ data: models.map(d => d.cost), backgroundColor: ['#22c55e', '#3b82f6', '#f59e0b', '#8b5cf6', '#ec4899'], borderColor: '#0a0a0a', borderWidth: 2 }]\n\t\t\t\t\t\t},\n\t\t\t\t\t\toptions: { responsive: true, maintainAspectRatio: false, animation: false, plugins: { legend: { position: 'bottom', labels: { color: colors.text } } } }\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst hourLabels = Array.from({length: 24}, (_, i) => `${i}:00`);\n\t\t\t\tconst hourData = hourLabels.map((_, i) => {\n\t\t\t\t\tconst found = (data.hourOfDay || []).find(d => d.hour === i);\n\t\t\t\t\treturn found ? found.sessions : 0;\n\t\t\t\t});\n\t\t\t\tcreateChart('hourChart', {\n\t\t\t\t\ttype: 'bar',\n\t\t\t\t\tdata: { labels: hourLabels, datasets: [{ label: 'Sessions', data: hourData, backgroundColor: colors.primary + '60', borderColor: colors.primary, borderWidth: 1 }] },\n\t\t\t\t\toptions: baseOptions\n\t\t\t\t});\n\n\t\t\t\tcreateChart('tokenChart', {\n\t\t\t\t\ttype: 'bar',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tlabels: ts.map(d => formatLabel(d.period)),\n\t\t\t\t\t\tdatasets: [\n\t\t\t\t\t\t\t{ label: 'Input', data: ts.map(d => d.tokens?.input || 0), backgroundColor: colors.input },\n\t\t\t\t\t\t\t{ label: 'Output', data: ts.map(d => d.tokens?.output || 0), backgroundColor: colors.output },\n\t\t\t\t\t\t\t{ label: 'Thinking', data: ts.map(d => d.tokens?.thinking || 0), backgroundColor: colors.thinking }\n\t\t\t\t\t\t]\n\t\t\t\t\t},\n\t\t\t\t\toptions: { ...baseOptions, scales: { x: { ...baseOptions.scales.x, stacked: true }, y: { ...baseOptions.scales.y, stacked: true, beginAtZero: true } } }\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfunction setActiveButton(range) {\n\t\t\t\tdocument.querySelectorAll('.time-range__btn').forEach(btn => {\n\t\t\t\t\tbtn.classList.toggle('time-range__btn--active', btn.dataset.range === range);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tasync function init() {\n\t\t\t\t// Preload all ranges\n\t\t\t\tawait Promise.all(ranges.map(r =>\n\t\t\t\t\tfetch(`/api/charts?range=${r}`)\n\t\t\t\t\t\t.then(res => res.json())\n\t\t\t\t\t\t.then(data => { cache[r] = data; })\n\t\t\t\t\t\t.catch(err => console.error(`Failed to fetch ${r}:`, err))\n\t\t\t\t));\n\n\t\t\t\t// Render initial\n\t\t\t\trenderCharts(cache[currentRange]);\n\n\t\t\t\t// Button click handlers\n\t\t\t\tdocument.querySelectorAll('.time-range__btn').forEach(btn => {\n\t\t\t\t\tbtn.addEventListener('click', () => {\n\t\t\t\t\t\tcurrentRange = btn.dataset.range;\n\t\t\t\t\t\tsetActiveButton(currentRange);\n\t\t\t\t\t\trenderCharts(cache[currentRange]);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tinit();\n\t\t})();\n\t</script>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

func toFloat(v interface{}) float64 {
	switch val := v.(type) {
	case float64:
		return val
	case int64:
		return float64(val)
	case int:
		return float64(val)
	default:
		return 0
	}
}

func shortPath(path string) string {
	if path == "" || path == "Unknown" {
		return "-"
	}
	return filepath.Base(path)
}

var _ = templruntime.GeneratedTemplate
