package dashboard

import (
	"fmt"
	"claude-watcher/internal/shared/templates"
)

templ Dashboard(data DashboardData) {
	@templates.Layout("Dashboard") {
		<h1>Dashboard</h1>
		<div class="stats-grid">
			@templates.StatsCard("Total Sessions", fmt.Sprintf("%d", data.Metrics.TotalSessions), "sessions")
			@templates.StatsCard("Total Cost", fmt.Sprintf("$%.2f", toFloat(data.Metrics.TotalCostUsd)), "cost")
			@templates.StatsCard("Total Tool Calls", fmt.Sprintf("%v", data.Metrics.TotalToolCalls), "tokens")
			@templates.StatsCard("Avg Duration", fmt.Sprintf("%.0f min", toFloat(data.Metrics.AvgDurationSeconds)/60), "sessions")
		</div>
		<section>
			<h2>Today</h2>
			<div class="stats-grid">
				@templates.StatsCard("Sessions", fmt.Sprintf("%d", data.Today.SessionsToday), "sessions")
				@templates.StatsCard("Cost", fmt.Sprintf("$%.2f", toFloat(data.Today.CostToday)), "cost")
			</div>
		</section>
		<section>
			<h2>This Week</h2>
			<div class="stats-grid">
				@templates.StatsCard("Sessions", fmt.Sprintf("%d", data.Week.SessionsWeek), "sessions")
				@templates.StatsCard("Cost", fmt.Sprintf("$%.2f", toFloat(data.Week.CostWeek)), "cost")
			</div>
		</section>
		<section>
			<h2>Token Usage</h2>
			<div class="token-breakdown">
				<div class="token-legend">
					<dl>
						<dt class="token-input">Input</dt>
						<dd>{ fmt.Sprintf("%v", data.Metrics.TotalInputTokens) }</dd>
						<dt class="token-output">Output</dt>
						<dd>{ fmt.Sprintf("%v", data.Metrics.TotalOutputTokens) }</dd>
						<dt class="token-thinking">Thinking</dt>
						<dd>{ fmt.Sprintf("%v", data.Metrics.TotalThinkingTokens) }</dd>
						<dt class="token-cache">Cache Read</dt>
						<dd>{ fmt.Sprintf("%v", data.Metrics.TotalCacheReadTokens) }</dd>
					</dl>
				</div>
			</div>
		</section>
	}
}

func toFloat(v interface{}) float64 {
	switch val := v.(type) {
	case float64:
		return val
	case int64:
		return float64(val)
	case int:
		return float64(val)
	default:
		return 0
	}
}
